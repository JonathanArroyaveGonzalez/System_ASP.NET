@model Votacion

@{
    ViewData["Title"] = "Detalles de Votación";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>@ViewData["Title"]</h1>

    <div>
        <a asp-controller="Asambleas" asp-action="Details" asp-route-id="@Model.AsambleaId"
           class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Volver
        </a>

        @if (User.IsInRole("admin"))
        {
            if (Model.Estado == "pendiente")
            {
                <a asp-action="Start" asp-route-id="@Model.Id" class="btn btn-warning">
                    <i class="fas fa-play"></i> Iniciar Votación
                </a>
            }
            else if (Model.Estado == "en_curso")
            {
                <a asp-action="Close" asp-route-id="@Model.Id" class="btn btn-danger">
                    <i class="fas fa-stop"></i> Concluir Votación
                </a>
            }

            <a asp-action="Results" asp-route-id="@Model.Id" class="btn btn-info">
                <i class="fas fa-chart-bar"></i> Ver Resultados
            </a>
        }
    </div>
</div>

<div class="card">
    <div class="card-header bg-primary text-white">
        <h3 class="card-title">@Model.Titulo</h3>
    </div>
    <div class="card-body">
        <div class="row mb-3">
            <div class="col-md-6">
                <h5><i class="fas fa-info-circle me-2"></i>Estado</h5>
                <span class="badge @GetStatusBadgeClass(Model.Estado)">
                    @Model.Estado
                </span>
            </div>
            <div class="col-md-6">
                <h5><i class="fas fa-calendar-alt me-2"></i>Período</h5>
                <p>
                    @Model.FechaInicio.ToString("dd/MM/yyyy HH:mm") -
                    @Model.FechaFin.ToString("dd/MM/yyyy HH:mm")
                </p>
            </div>
        </div>

        <div class="mb-3">
            <h5><i class="fas fa-align-left me-2"></i>Descripción</h5>
            <p>@Model.Descripcion</p>
        </div>

        <div class="mb-3">
            <h5><i class="fas fa-vote-yea me-2"></i>Tipo de votación</h5>
            <p>@(Model.TipoVotacion == "publica" ? "Pública" : "Secreta")</p>
        </div>
    </div>
</div>

<!-- Sección de Votación -->
@if (Model.Estado == "en_curso" && !ViewBag.YaVoto)
{
    <div class="card mt-4">
        <div class="card-header bg-success text-white">
            <h3 class="card-title mb-0">Participar en la votación</h3>
        </div>
        <div class="card-body">
            <form asp-action="Votar" method="post">
                <input type="hidden" name="id" value="@Model.Id" />

                <div class="mb-3">
                    <label class="form-label">Seleccione una opción:</label>

                    @foreach (var opcion in Model.OpcionVotacions)
                    {
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="opcionId"
                                   id="opcion-@opcion.Id" value="@opcion.Id" required>
                            <label class="form-check-label" for="opcion-@opcion.Id">
                                <strong>@opcion.Texto</strong>
                                @if (!string.IsNullOrEmpty(opcion.Descripcion))
                                {
                                    <br />

                                    <small class="text-muted">@opcion.Descripcion</small>
                                }
                            </label>
                        </div>
                    }
                </div>

                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> Enviar mi voto
                </button>
            </form>
        </div>
    </div>
}
else if (ViewBag.YaVoto)
{
    <div class="alert alert-info mt-4">
        <i class="fas fa-info-circle me-2"></i> Ya has participado en esta votación.
    </div>
}
else if (Model.Estado == "pendiente")
{
    <div class="alert alert-warning mt-4">
        <i class="fas fa-clock me-2"></i> Esta votación aún no ha comenzado.
    </div>
}
else if (Model.Estado == "concluida")
{
    <div class="alert alert-success mt-4">
        <i class="fas fa-check-circle me-2"></i> Esta votación ha concluido.
    </div>
}

@functions {
    public string GetStatusBadgeClass(string status)
    {
        return status switch
        {
            "pendiente" => "bg-secondary",
            "en_curso" => "bg-warning text-dark",
            "concluida" => "bg-success",
            "cancelada" => "bg-danger",
            _ => "bg-info"
        };
    }
}